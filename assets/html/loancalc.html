<!-- This script has been in the http://www.javascripts.com Javascript Public Library! -->
<!-- Note that though this material may have been in a public depository, certain author copyright restrictions may apply. -->
<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<meta http-equiv="Pragma" content="no-cache">
<meta name="GENERATOR" content="Microsoft FrontPage 12.0">
<title>JavaScript Mortgage Loan Calculator - by Steven Witkop</title>
<!-- Copyright -->
</head>

<body bgcolor="#FFFFFF" link="#0000FF" vlink="#0000FF" alink="#0000FF" onload="setfocus()">
<font face="Arial"><script language="JavaScript">
//<font face="Comic Sans MS"><script language="JavaScript">

<!--

/* hide this code from non scriptable browsers



If you run into any problems while trying to configure this script, help is available.  

       1) E-mail the author at: Qube@ix.netcom.com



                            MORTGAGE LOAN CALCULATOR

COPYRIGHT NOTICE                                                         

Copyright 1997, 1998 Steven D. Witkop  All Rights Reserved.



This Javascript "Mortgage Loan calculator" Script  may be used and modified free of charge by anyone
so long as this copyright notice and the comments above remain intact.  By using this code you agree 
to indemnify Steven D. Witkop from any liability that  might arise from it's use.   

Selling the code for this program without prior written consent is  expressly forbidden.  In other 
words, please ask first before you try and  make money off of my program.  

Obtain permission before redistributing this software over the Internet or in any other medium. 
In all cases copyright and header must remain intact

 LANGUAGE: JavaScript 1.1 compliant

  PATTERN: MVC

*/



// initilize page variables

window.onerror=null
var bState = true;
var rec = 0;
var oTable = new Array();

// the colors for the amortization table... you will need to search and replace on these codes for the HTML form.
var bColor = '#ffffff' // white
var fColor = '#C8B995' // table header color
var hColor = '#843758' //H2 color - maroon
var shColor = '#393931' // subHeadline
// var fColor = '#008080' // green

// var bColor = 'WHITE'  // '#FFFFFF' 
// var fColor = 'PURPLE' // '#800080'


// names for the collections (used for form validation)
oReq = new Collection("AMOUNT","RATE","","","","")
oVal = new Collection("AMOUNT","RATE","","","","")
oTst = new Collection("N","N","","","","")


//============================================================================
// Gets called when the user pressed one of the buttons.
// oForm: 		form elements
// oBtn:  		the name of the button that was pressed
// return value:	did we make it through?
//============================================================================

function controller(oForm, oBtn) {

   while (bState) {

      if (!Required(oForm))

         break;

      if (!Validate(oForm))

         break;

      if (!Create())

         break;

      if (!SetValue(oForm))

         break;

      if (!Amortize(oForm, oBtn))

         break;

      if (bState) {

          bState = false

      }

   }

   bState = true

}



//============================================================================
// Check if a form element is required by comparing the all of the form
// elements against a collection of required form control names.
// oView: 		form elements
// oReq		required elements
// return value:	did it pass the test?
//============================================================================

function Required(oView) {

   for (i in oView ) {

      for (j in oReq) {

          if (i == oReq[j]) {      

             if (isMissing(oView[i])) {

               return(false)

             }

          }

      } 

  }

  return(true)

}



//============================================================================
// Check if a form control is required and missing
// oView: 		a form control
// Return value:	do we have a problem?
//============================================================================

function isMissing(oCtrl) {

   if (oCtrl.value == "") {  

      alert("You have left a required value blank. Please type a number");

      oCtrl.focus();

      oCtrl.select();

      return(true)

      }

   else

      { 

      return(false)

   }

}



//============================================================================
// Check if a form element inputs need to be a certain type by
// comparing all of the form elements against a collection of 
// form controls that need specific types of input data.
// oView: 		form elements
// oReq		required elements
// return value:	did it pass the test?
//============================================================================

function Validate(oView) {

   for (i in oView) {

      for (j in oVal) {

        if (i==oVal[j] && oTst[j]=="N") {      

           if (isTest(oView[i], oTst[j])) {

               return(false)

           }

        }

     }

  }

  return(true)

}



//============================================================================
// Check if a form control input is the right type
// oView: 		a form control
// Return value:	do we have a problem?
//============================================================================

function isTest(oCtrl, oTest) {

   if (oTest=="N" && !isNumber(oCtrl.value) ) {

      alert(oCtrl.value+" contains an invalid character. Please type a number");

      oCtrl.focus();

      oCtrl.select();

      return(true)

      }

      else

      { 

      return(false)

   }

}



//============================================================================
// Check if the result is a number
// input: 		a texbox value
// Return value:	true / false
//============================================================================

function isNumber(input) {

var result = ""

var nperiods = 0;

   for (var i=0;i<input.length;i++) {

      var ch = input.substring(i, i+1);

      if (!isNaN(parseInt(ch))) {

         result = result + ch

      } 

      if (ch==".") {

        nperiods++;

      }

      if (nperiods==1){

         result = result + ch  

      }

   }

   if (result == ""){

     return(false);

   }

return(true)

}



//============================================================================
// Make a string input into a number
// input: 		a texbox value
// Return value:	a number
//============================================================================

function makeNumber(input) {

var result = ""
var nperiods = 0;

   for (var i=0;i<input.length;i++) {

       var ch = input.substring(i, i+1);
	   
	   var decCh = ""
       
       var flag = true;

       if (!isNaN(parseInt(ch))) {

          result = result + ch

       }           

       if (ch==".") {

         nperiods++;
         decCh = ch;

       }

       if (nperiods==1){

          result = result + decCh  

       }
     }

  return(result)

}


//============================================================================
// Create a default instance of the object
// parm1:	Amount	- required
// parm2:	Rate		- required
// parm3:   	Term		- required
// parm4:	Payment
// parm5:	Interest
// parm6:	Frequency	- required
// parm7:	Periods
// return value:	did we create the oebject?
//============================================================================

function Create() {

   Mortgage = new Loan(50000, 8, 30, 0, 0, 1, 1 );

   return(true)

}


//============================================================================
// Set the properties of the object based on form inputs
// oView: 		form elements
// return value:	did it get and set the properties?
//============================================================================

function SetValue(oView) {

   // get the properties mapped from the form

   Mortgage.Amount = makeNumber(oView.AMOUNT.value);

   // works like a masked edit
   oView.AMOUNT.value = calcRound(Mortgage.Amount);

   Mortgage.Rate = makeNumber(oView.RATE.value);

   Mortgage.Term = get_selection(oView.YEARS);

   //Mortgage.Frequency = get_selection(oView.FREQUENCY);
   Mortgage.Frequency = 1;

   // set the number of periods
   //Mortgage.calcPeriods();
   Mortgage.Periods = 1;

   // set the monthly payment
   Mortgage.calcPayment();

   // set the total interest due
   Mortgage.calcInterest();

   // update the form view
   Show()

   return(true)

}


//============================================================================
// Amortize is called at the end of the controler loop and checks to see
// if the amortize button was pushed
// oForm: 		form elements
// oBtn:  		the name of the button that was pressed
// return value:	did we select the Amortize button?
//============================================================================

function Amortize(oForm, oBtn) {

   if (oBtn.name == "cmdCalc") {

      return(false)

   }

   if (confirm("An Amortization Table calculates the periodic payment breakdown for each specific category listed.")) {

      // need to create the table before you can show it
      createRecords();

      // display the table
      showAmortize(oForm);

      return(true)

    }

  return(false)

}



//============================================================================
// create Records computes the values associated with the Amortzation of a Mortgage Loan and 
// adds those values to a record in the Amortization table container array
// return value:	did we calculate all values to display in the Amortization?
//============================================================================

function createRecords(){

   // re-init the record counter and container array
   rec = 0;

   oTable = new Array();

   // initialize variables
   var currInt = 0;

   var currPrin = 0;

   prevBalance = Mortgage.Amount;

   InterestRate = ( Mortgage.Rate /100) / Mortgage.Periods;

   MonthlyPayment = Mortgage.Payment;

   //currStart = '2022';
   currStart = get_selection(document.MORTGAGE.START);
  
   // let the loops begin
   for(i=1;i<=30;i++) {

      for(j=1;j<=Mortgage.Periods;j++) {

         periodInt = prevBalance * InterestRate;

         periodPrin = MonthlyPayment - periodInt;

         currBal = prevBalance - periodPrin;

         currInt += periodInt;

         currPrin += periodPrin;

         prevBalance = currBal;

      }

      if( currBal <= 0 ){ 

         currBal = 0;

      }



      // set the parameters
      Year = currStart;
      Interest = calcRound(currInt);
      Principle = calcRound(currPrin);
      Balance = calcRound(currBal);

      // increment the container 
      rec++

      // add a record to the table
      addRecord(Year, Interest, Principle, Balance);

      // re-init the private variables
      currInt = 0;
      currPrin = 0;
      currStart = parseInt(currStart);
      currStart += 1;

      // are we done?
      if(currBal<=0) {

         return(true)

      }       

   }

   return (true)

}

//============================================================================
// Build a text string with a header, the table and a footer in HTML then
// diplay the table in a new window with only the menu active.
// oForm: 		form elements
// return value:	did we display the Amortization?
//============================================================================

function showAmortize(oForm) {

   // create the header

   text = ("<HEAD><TITLE>Amortization Table</TITLE></HEAD>");

   text = (text +"<BODY style='font-family:Arial' BGCOLOR =  "+bColor+"><BR><BR>");

   text = (text +"<H2 ALIGN=CENTER><FONT COLOR="+hColor+">Amortization Table</FONT></H2>");

   text = (text +"<UL><FONT SIZE=-1 COLOR="+shColor+">The following table is based on the information entered in the calculator form.</FONT></UL>");

   text = (text +"<UL><FONT SIZE=-1 COLOR="+hColor+"> Principal Amount: </FONT>" +calcRound(Mortgage.Amount));

   text = (text +"<BR><FONT SIZE=-1 COLOR="+hColor+">   Interest Rate: </FONT>" + Mortgage.Rate + " %");

   text = (text +"<BR><FONT SIZE=-1 COLOR="+hColor+"> Term: </FONT>" + Mortgage.Term + " Years");

   text = (text +"<BR><FONT SIZE=-1 COLOR="+hColor+"> Annual Payment: </FONT>" + calcRound(Mortgage.Payment) + "  </UL>");
   
   text = (text +"  </UL>");

   text = (text +"<BR><CENTER><table border='1' width='100%'>");

   text = (text +"<TR><TH SCOPE=col ALIGN=CENTER BGCOLOR="+fColor+"><FONT SIZE=-1 COLOR="+shColor+"><B>Year</B></FONT></TH><TH SCOPE=col ALIGN=RIGHT BGCOLOR="+fColor+"><FONT SIZE=-1 COLOR="+shColor+"><B>Interest&nbsp;</B></FONT></TH><TH SCOPE=col ALIGN=RIGHT BGCOLOR="+fColor+"><FONT SIZE=-1 COLOR="+shColor+"><B>Principal&nbsp;</B></FONT></TH><TH SCOPE=col ALIGN=RIGHT BGCOLOR="+fColor+"><FONT SIZE=-1 COLOR="+shColor+"><B>Balance&nbsp;</B></FONT></TH></TR>\n");
     
   // create the Amortization table text by looping through a CONTAINER ARRAY 

   for (var q=1; q<oTable.length;q++) {

      text = (text +"<TR><TH SCOPE=row ALIGN=CENTER>"+ oTable[q].Year +"</TH><TD ALIGN=RIGHT>"+ oTable[q].Interest +"&nbsp;</TD><TD ALIGN=RIGHT>"+ oTable[q].Principle +"&nbsp;</TD><TD ALIGN=RIGHT>"+ oTable[q].Balance +"&nbsp;</TD></TR>");

   }

   

   // create the footer  

   text = (text +"</TABLE></CENTER>");



   // Create a new window to display the results

   oWindow=window.open("","displayWindow","toolbar=no,width=500,height=400,directories=no,status=no,scrollbars=yes,resize=yes,menubar=yes");

   oWindow.document.write(text);

   oWindow.document.close();



   return(true)

}





//============================================================================
// Collection Constructor, a custom object to act as an array but provide
// more flexibility in the future.
//============================================================================

function Collection(item1, item2, item3, item4, item5, item6) {

   this.item1 = item1;

   this.item2 = item2;

   this.item3 = item3;

   this.item4 = item4;

   this.item5 = item5;

   this.item6 = item6;

}



//============================================================================
// Loan Constructor, defines what the Loan object will look like
// and how it will behave. 
//============================================================================

function Loan(Amount, Rate, Term, Payment, Interest, Frequency, Periods ) {

   this.Amount = Amount;

   this.Rate = Rate;

   this.Term = Term;

   this.Payment = Payment;

   this.Interest = Interest;

   this.Frequency = 1;

   this.Periods = 1;

   //this.calcPeriods = calcPeriods;

   this.calcPayment = calcPayment;

   this.calcInterest = calcInterest;

}



//============================================================================
// Loan object method that calculates the monthly payment for a mortgage loan in the US
//============================================================================

function calcPayment() {

   // original calc
   //this.Payment = (this.Amount*((this.Rate/(1200))/(1-(Math.pow(1+(this.Rate/(1200)),((this.Term*12)*-1))))));
   
   this.Payment = ((this.Amount*(this.Rate/100))/(1-(Math.pow((1+(this.Rate/100)),(this.Term*-1)))));
   

}



//============================================================================
// Loan object method that calculates the interest portion of a loan
//============================================================================

function calcInterest() {

   this.Interest = ((this.Payment*(this.Term*this.Periods))-this.Amount);

}



//============================================================================
// Loan object method that translates a selection drop down to a value
//============================================================================

function calcPeriods() {

   //if (this.Frequency=="Monthly") { this.Periods=12 } else { this.Periods=26 }
   this.Periods=1

}



//============================================================================
// Loan object method that shows the calculated amounts
//============================================================================

function Show(oView) {

   document.MORTGAGE.PAYMENT.value = calcRound(Mortgage.Payment)

   document.MORTGAGE.INTEREST.value = calcRound(Mortgage.Interest)

}



//============================================================================
// oRecord Constructor, defines what the Amortzation record looks like 
//============================================================================

function oRecord(Year, Interest, Principle, Balance){

   this.Year = Year;

   this.Interest = Interest;

   this.Principle = Principle;

   this.Balance = Balance;

}



//============================================================================
// addRecord defines how a record gets added to the container array
//============================================================================

function addRecord(Year, Interest, Principle, Balance){

   oTable[rec] = new oRecord(Year, Interest, Principle, Balance);

}



//============================================================================
// select_item Constructor, used to retrive the selected item from the dropdown 
// control on a form.
// name: 		form element name
// value:  		the value of the options that was selected
// return value:	selected item
//============================================================================

function select_item(name, value) {  

   this.name = name;

   this.value = value;

}



//============================================================================
// Common routine to retrieve the selected value from the drop down object
// select_object:	a drop down from control
// return value:	the selected objects name
//============================================================================

function get_selection(select_object) {   

   contents = new select_item();

   for(var i=0;i<select_object.options.length;i++)

      if(select_object.options[i].selected == true) {

        contents.name = select_object.options[i].text;

        contents.value = select_object.options[i].value;

      }      

   return(contents.name)

}



//============================================================================
// Common routine for rounding that also formats the results into US currency
// num: 		a number
// return value:  result is rounded and formated for currency $999,999.00
//============================================================================

function calcRound(num) {

   result="$"+Math.floor(num)+"." ;

   n = result.length;

   if (num>1000 && num<999999) {  

     result="$"+result.substring(1,n-4)+","+result.substring(n-4,n);

   }

   if (num>=1000000) {  

     result = "$"+result.substring(1,n-7)+","+result.substring(n-7,n-4)+","+result.substring(n-4,n);

   }

   var cents=100*(num-Math.floor(num))+0.5;

   result += Math.floor(cents/10);

   result += Math.floor(cents%10);

   return(result)

}





//============================================================================
// A page specific routine to set the initial state when the page is reloaded.
//============================================================================

function setfocus() {   

   document.MORTGAGE.AMOUNT.focus();

   document.MORTGAGE.AMOUNT.select();

}



// unhide 

// --></script>


</font>


<table border="0" cellpadding="0" cellspacing="0" width="100%" role="presentation">
  <tr>
    <td><table border="0" cellpadding="2" width="53%" role="presentation">
      <tr>
        <td valign="top" width="492"><form name="MORTGAGE" align="right">
          <table border="1" cellpadding="6" width="487" role="presentation">
            <tr>
              <td align="right" bordercolor="#C8B995" bordercolordark="#C8B995"
              bordercolorlight="#C8B995" colspan="2">
				<h2 align="center" style="line-height: .6em;">
				<font face="Arial" size="5" color="#843758"><strong>Water Project Loan <br>
				Program Calculator</strong></font></h2>
				<p align="center"><font face="Arial" size="2" color="#393931" >
	Calculate <b>annual</b> payments based on <br>
	principal, interest and term.</font></p></td>
<font face="Arial" color="#843758">
            </tr>
            <tr>
              <td align="right" bordercolor="#C8B995" bordercolordark="#C8B995"
              bordercolorlight="#C8B995" width="210">
				<label for="first-payment-year"><font size="2" face="Arial" color="#393931"><strong>First Payment Year&nbsp;</strong></font></label></td>
              <td align="left" valign="top" bgcolor="#92c5d1" bordercolor="#C8B995" bordercolordark="#C8B995"
              bordercolorlight="#336633" width="247">
				<font face="Arial" color="#843758">&nbsp;<select id="first-payment-year" name="START" size="1">
          		<option selected>2025</option>
			<option>2026</option>
			<option>2027</option>
			<option>2028</option>
			<option>2029</option>
              </select></td>
            </tr>
<font face="Arial" color="#843758">
            <tr>
              <td align="right" bordercolor="#C8B995" bordercolordark="#C8B995"
              bordercolorlight="#C8B995" width="210" style="height: 33px"><b>
				<label for="principal-amount"><font size="2" face="Arial" color="#393931">Principal Amount&nbsp;</font></label></b></td>
</font>
<font face="Arial" color="#843758">
              <td align="left" valign="top" bgcolor="#92c5d1" bordercolor="#C8B995" bordercolordark="#C8B995"
              bordercolorlight="#C8B995" width="247" style="height: 33px">&nbsp;<input id="principal-amount" type="text" size="12" name="AMOUNT" value="0"></td>
            </tr>
            <tr>
              <td align="right" bordercolor="#C8B995" bordercolordark="#C8B995"
              bordercolorlight="#C8B995" width="210">
				<font size="2" face="Arial" color="#393931"><strong><span id="interest-rate-label">Interest Rate&nbsp;</span></strong></font></td>
              <td align="left" valign="top" bgcolor="#92c5d1" bordercolor="#C8B995" bordercolordark="#C8B995"
              bordercolorlight="#C8B995" width="247">&nbsp;<input aria-labelledby="interest-rate-label interest-rate-percent" type="text" size="4" name="RATE" value="0"> 
				<font
              color="#393931" face="Arial" size="2"><strong><span id="interest-rate-percent">%</span></strong></font></td>
            </tr>
<font face="Arial" color="#843758" size="2">
            <tr>
              <td align="right" bordercolor="#C8B995" bordercolordark="#C8B995"
              bordercolorlight="#C8B995" width="210"><b>
				<font face="Arial" color="#393931" size="2"><span id="term-label">Term&nbsp;</span></font></b></td>
</font>
<font face="Arial" color="#843758">
              <td align="left" valign="top" bgcolor="#92c5d1" bordercolor="#C8B995" bordercolordark="#C8B995"
              bordercolorlight="#C8B995" width="247">&nbsp;<select aria-labelledby="term-label term-years" name="YEARS" size="1">
                <option>40</option>
                <option selected>30</option>
                <option>27</option>
                <option>20</option>
				<option>15</option>
				<option>10</option>
              </select> <font color="#393931" face="Arial" size="2"><strong><span id="term-years">Years&nbsp;</span></strong></font></td>
            </tr>
            <tr>
              <td align="right" bordercolor="#C8B995" bordercolordark="#C8B995"
              bordercolorlight="#C8B995" width="210">
				<font face="Arial" size="1" color="#393931"><span id="amortize-description">You will need to 
				hold down the Ctrl key when clicking the Amortize button to open 
				the amortization schedule</span></font></td>
              <td align="left" valign="top" bgcolor="#92c5d1" bordercolor="#C8B995" bordercolordark="#C8B995"
              bordercolorlight="#C8B995" width="247">&nbsp;<input type="button" name="cmdCalc" value="  Calculate  "
              onclick="controller(this.form, this)" style="font-family: Arial">&nbsp;<input type="reset" name="cmdReset"
              value="Reset" style="font-family: Arial">&nbsp;<input aria-describedby="amortize-description"  type="button" name="cmdAmortize" value="Amortize"
              onclick="controller(this.form, this)" style="font-family: Arial"></td>
            </tr>
            <tr>
              <td align="right" bordercolor="#C8B995" bordercolordark="#C8B995"
              bordercolorlight="#C8B995" width="210">
				<label id="annual-payment-amount-label"><font size="2" face="Arial" color="#393931"><strong>Annual Payment Amount&nbsp;</strong></font></label></td>
              <td align="left" valign="top" bgcolor="#92c5d1" bordercolor="#C8B995" bordercolordark="#C8B995"
              bordercolorlight="#C8B995" width="247">&nbsp;<input aria-labelledby="annual-payment-amount-label"  aria-describedby="payment-amount-description" type="text" size="12" name="PAYMENT" value="0"></td>
            </tr>
            <tr>
              <td align="right" width="210">
				<label for="total-interest"><font size="2" face="Arial" color="#393931"><strong>Total Interest to Be Paid on Loan&nbsp;</strong></font></label></td>
              <td align="left" bgcolor="#92c5d1" width="247">&nbsp;<input id="total-interest" type="text" size="12" name="INTEREST" value="0"></td>
            </tr>
          </table>
        </form>
        </td>
        <td valign="top" rowspan="2">&nbsp;</td>
      </tr>
      <tr>
        <td valign="top" width="492">
		<p align="center" id="payment-amount-description"><b><font face="Arial" size="1" color="#393931">
		Payment amounts are approximate.&nbsp; Accurate figures are determined upon processing 
		of a loan.</font></b></td>
      </tr>
    </table>
    </td>
  </tr>
</table>

<p><br>
<br>
</p>
</font>
</font>
</font>
</body>
</html>

